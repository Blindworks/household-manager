<div class="utility-price-form">
  <h3 class="form-title">Neuen Preis erfassen</h3>

  <!-- Success Message -->
  <div class="alert alert--success" *ngIf="successMessage">
    <app-icon name="check-circle" class="alert__icon"></app-icon>
    <span class="alert__message">{{ successMessage }}</span>
  </div>

  <!-- Error Message -->
  <div class="alert alert--error" *ngIf="errorMessage">
    <app-icon name="alert-triangle" class="alert__icon"></app-icon>
    <span class="alert__message">{{ errorMessage }}</span>
  </div>

  <form [formGroup]="priceForm" (ngSubmit)="onSubmit()" class="form">
    <!-- Zählertyp -->
    <div class="form-group">
      <label for="meterType" class="form-label">
        <app-icon name="gauge" [size]="16" class="form-label__icon"></app-icon>
        Zählertyp <span class="required">*</span>
      </label>
      <select
        id="meterType"
        formControlName="meterType"
        class="form-control"
        [class.form-control--error]="isFieldInvalid('meterType')"
      >
        <option value="" disabled>Bitte wählen...</option>
        <option *ngFor="let type of meterTypes" [value]="type">
          {{ meterTypeUtils.getLabel(type) }}
        </option>
      </select>
      <div class="form-error" *ngIf="isFieldInvalid('meterType')">
        {{ getFieldError('meterType') }}
      </div>
    </div>

    <!-- Preis pro Einheit -->
    <div class="form-group">
      <label for="pricePerUnit" class="form-label">
        <app-icon name="euro" [size]="16" class="form-label__icon"></app-icon>
        Preis pro Einheit <span class="required">*</span>
        <span class="form-hint" *ngIf="priceForm.get('meterType')?.value">
          (in EUR / {{ meterTypeUtils.getUnit(priceForm.get('meterType')?.value) }})
        </span>
      </label>
      <input
        type="number"
        id="pricePerUnit"
        formControlName="pricePerUnit"
        class="form-control"
        [class.form-control--error]="isFieldInvalid('pricePerUnit')"
        placeholder="z.B. 0.3250"
        step="0.0001"
        min="0.0001"
      />
      <div class="form-error" *ngIf="isFieldInvalid('pricePerUnit')">
        {{ getFieldError('pricePerUnit') }}
      </div>
    </div>

    <!-- Gültig ab -->
    <div class="form-group">
      <label for="validFrom" class="form-label">
        <app-icon name="calendar-check" [size]="16" class="form-label__icon"></app-icon>
        Gültig ab <span class="required">*</span>
      </label>
      <input
        type="date"
        id="validFrom"
        formControlName="validFrom"
        class="form-control"
        [class.form-control--error]="isFieldInvalid('validFrom')"
      />
      <div class="form-error" *ngIf="isFieldInvalid('validFrom')">
        {{ getFieldError('validFrom') }}
      </div>
    </div>

    <!-- Gültig bis -->
    <div class="form-group">
      <label for="validTo" class="form-label">
        <app-icon name="calendar-x" [size]="16" class="form-label__icon"></app-icon>
        Gültig bis <span class="optional">(optional)</span>
      </label>
      <input
        type="date"
        id="validTo"
        formControlName="validTo"
        class="form-control"
        [class.form-control--error]="isFieldInvalid('validTo') || isDateRangeInvalid()"
      />
      <div class="form-error" *ngIf="isDateRangeInvalid()">
        "Gültig bis" muss nach "Gültig ab" liegen
      </div>
      <div class="form-hint">Leer lassen, wenn der Preis unbegrenzt gültig ist</div>
    </div>

    <!-- Buttons -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn--primary"
        [disabled]="isSubmitting"
      >
        <span *ngIf="!isSubmitting">
          <app-icon name="save" [size]="18"></app-icon>
          Preis speichern
        </span>
        <span *ngIf="isSubmitting" class="btn__loading">
          <span class="spinner"></span>
          Wird gespeichert...
        </span>
      </button>

      <button
        type="button"
        class="btn btn--secondary"
        (click)="resetForm()"
        [disabled]="isSubmitting"
      >
        <app-icon name="rotate-ccw" [size]="18"></app-icon>
        Zurücksetzen
      </button>
    </div>
  </form>
</div>
